# Ultralytics ðŸš€ AGPL-3.0 License - https://ultralytics.com/license

# PKINet YOLO11 object detection model with P3/8 - P5/32 outputs

# Parameters
nc: 80 # number of classes
scales: # model compound scaling constants
  # [depth, width, max_channels]
  n: [0.33, 0.25, 1024]
  s: [0.33, 0.50, 1024]

# PKINet backbone
backbone:
  # [from, repeats, module, args]
  - [-1, 1, PKIStem, [16]] # 0-P1/2             640 x 640 x 3 -> 320 x 320 x 16
  - [-1, 1, PKIStage, [32, 2, 8.0, 5]] # 1-P2/4            320 x 320 x 16 -> 160 x 160 x 32
  - [-1, 1, PKIStage, [64, 4, 8.0, 7]] # 2-P3/8           160 x 160 x 32 -> 80 x 80 x 64
  - [-1, 1, PKIStage, [128, 6, 4.0, 9]] # 3-P4/16          80 x 80 x 64 -> 40 x 40 x 128
  - [-1, 1, PKIStage, [256, 2, 4.0, 11]] # 4-P5/32         40 x 40 x 128 -> 20 x 20 x 256

# é€‚é…PKINetçš„FPN+PANç»“æž„
head:
  # FPN (è‡ªä¸Šè€Œä¸‹çš„ç‰¹å¾é‡‘å­—å¡”)
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]] # 5    20 x 20 x 256 -> 40 x 40 x 256
  - [[-1, 3], 1, Concat, [1]] # 6 cat backbone P4     40 x 40 x (256 + 128 = 384)
  - [-1, 2, C3k2, [128, False]] # 7                   40 x 40 x 384 -> 40 x 40 x 128

  - [-1, 1, nn.Upsample, [None, 2, "nearest"]] # 8    40 x 40 x 128 -> 80 x 80 x 128
  - [[-1, 2], 1, Concat, [1]] # 9 cat backbone P3     80 x 80 x (128 + 64 = 192)
  - [-1, 2, C3k2, [64, False]] # 10 (P3/8-small)      80 x 80 x 192 -> 80 x 80 x 64

  # PAN (è‡ªä¸‹è€Œä¸Šçš„è·¯å¾„å¢žå¼º)
  - [-1, 1, Conv, [64, 3, 2]] # 11                   80 x 80 x 64 -> 40 x 40 x 64
  - [[-1, 7], 1, Concat, [1]] # 12 cat head P4        40 x 40 x (64 + 128 = 192)
  - [-1, 2, C3k2, [128, False]] # 13 (P4/16-medium)   40 x 40 x 192 -> 40 x 40 x 128

  - [-1, 1, Conv, [128, 3, 2]] # 14                   40 x 40 x 128 -> 20 x 20 x 128
  - [[-1, 4], 1, Concat, [1]] # 15 cat head P5        20 x 20 x (128 + 256 = 384)
  - [-1, 2, C3k2, [256, True]] # 16 (P5/32-large)     20 x 20 x 384 -> 20 x 20 x 256

  - [[10, 13, 16], 1, Detect, [nc]] # Detect(P3, P4, P5)